!function(i,n){function t(t){this.wrap=t,this.dataList=[],this.indexObj=null,this.rotateTimer=null,this.list=null,this.curIndex=0,this.progress=n.progress.pro()}t.prototype={init:function(){this.getDom(),this.getData("../mock/data.json")},getDom:function(){this.songCard=document.querySelector(".songImg img"),this.controlBtns=document.querySelectorAll(".control li")},getData:function(t){var s=this;i.ajax({url:t,method:"get",success:function(t){s.dataList=t,s.listchange(),s.indexObj=new n.controlIndex(s.dataList.length),s.loadMusic(s.indexObj.index),s.musicControl(),s.dragProgress()},error:function(){}})},loadMusic:function(t){var s=this;n.render(this.dataList[t]),n.music.loadmusic(this.dataList[t].audioSrc),this.progress.rendertotalTime(this.dataList[t].duration),"play"==n.music.stauts&&(n.music.playMusic(),this.controlBtns[2].className="playing",this.rotateImg(0),this.progress.move(0)),this.list.changactive(t),this.curIndex=t,n.music.end(function(){s.loadMusic(s.indexObj.next())})},musicControl:function(){var s=this;this.controlBtns[1].addEventListener("touchend",function(){n.music.stauts="play",s.loadMusic(s.indexObj.prev())}),this.controlBtns[2].addEventListener("touchend",function(){var t;"play"==n.music.stauts?(n.music.pauseMusic(),this.className="",s.stopRotate(),s.progress.stop()):(n.music.playMusic(),this.className="playing",t=s.songCard.dataset.rotate||0,s.rotateImg(t),s.progress.move())}),this.controlBtns[3].addEventListener("touchend",function(){n.music.playMusic(),s.loadMusic(s.indexObj.next())})},rotateImg:function(t){var s=this;clearInterval(s.rotateTimer),this.rotateTimer=setInterval(function(){t=+t+.2,s.songCard.style.transform=`rotate(${t}deg)`,s.songCard.dataset.rotate=t},1e3/60)},stopRotate:function(){clearInterval(this.rotateTimer)},listchange:function(){var i=this;this.list=n.listControl(this.dataList,this.wrap),this.controlBtns[4].addEventListener("touchend",function(){i.list.slideup()}),this.list.musiclist.forEach(function(t,s){t.addEventListener("touchend",function(){i.curIndex!=s&&(n.music.stauts="play",i.indexObj.index=s,i.loadMusic(s),i.list.slidedown())})})},dragProgress:function(){var i=this,t=n.progress.drag(document.querySelector(".circle"));t.init(),t.start=function(){},t.move=function(t){i.progress.updata(t)},t.end=function(t){var s=t*i.dataList[i.indexObj.index].duration;n.music.playTo(s),n.music.playMusic(),i.progress.move(t);t=i.songCard.dataset.rotate||0;i.rotateImg(t),i.controlBtns[2].className="playing"}}},new t(document.getElementById("wrap")).init()}(window.Zepto,window.player);